<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elysian Realm helper, kinda</title>

    <style>
        main {
            display: flex;
            flex-direction: column;
            max-width: 960px;
            margin: 0 auto;
        }

        #outputCode {
            background-color: #2e3440ff;
            color: #D8DEE9;
            font-size: 14px;

            padding: 1rem;
            margin: 1rem auto;
            white-space: pre-wrap;
            overflow: auto;
            overflow-wrap: break-word;
        }

        .block {
            display: block
        }

        #actionJSON,
        #actionObj {
            padding: 0.5rem;
            margin-top: 0.5rem;
            display: block;
        }

        #input {
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>
    <main>
        <h2>Hello there!</h2>

        <div id="input">
            <h3>Input:</h3>
            <div style="display: flex; flex-direction:row;">
                <div style="width: 50%;">
                    <span class="block">JSON:</span>
                    <textarea name="valkInputJSON" id="valkInputJSON" cols="30" rows="10"
                        placeholder="Paste your valk info here"></textarea>
                    <button id="actionJSON">Build markdown from JSON</button>
                </div>
                <div style="width: 50%;">
                    <span class="block">JS Object (from sources):</span>
                    <textarea name="valkInputObj" id="valkInputObj" cols="30" rows="10"
                        placeholder="Paste your valk info here"></textarea>
                    <button id="actionObj">Build markdown from Object</button>
                </div>
            </div>
        </div>

        <div id="output">
            <h3>Output:</h3>
            <button id="copyBtn">Click to copy</button>
            <pre id="outputCode"><code></code></pre>
        </div>

    </main>

    <script>
        let buildFromJSON = (e) => {
            let inp = document.getElementById('valkInputJSON') 
            let valk = JSON.parse(inp.value)

            build(valk)
        }

        let objectToRentry = () => {
            let data = document.getElementById('valkInputObj')
            eval(`var valkyrie = ${data.value}`) // TRAILING COMMA IS FUCKING DISASTER
            parse(valkyrie)
        }

        let parse = (valkyrie) => {
            let result = ""

            for (const build of valkyrie.builds) {
                let title = valkyrie.builds.length > 1 ? `## -> ${build.name} <-\n\n` : ""
                let supports = buildSupports(build.supports)
                let signets = buildSignets(build.signets)

                result += `${title} ${supports} \n\n ${signets} \n\n`
            }

            document.getElementById("outputCode").innerHTML = result
        }

        // let phasesOrder = {Early: 1, Mid: 2, Late: 3, default: 100}
        let buildSupports = (supports) => {
            let phases = ['Time | Sigils | Support 1 | Support 2\n:------:|:------:|:------:|:------:']
            supports.forEach(el => phases.push(el.time + " | " + el.sigils + " | " + el.support_1 + " | " + el.support_2))

            return phases.join('\n')
        }

        // let signetsOrder = {Start: 1, '1st': 2, '2nd': 3, '3rd': 4, Filler: 5, No: 6, default: 100}
        let buildSignets = (signets) => {
            builds = []
            for (const signet of signets) {
                let table = [`### -> ${getFCName(signet.name)} <-`, 'Signet | Priority', '----|:----:']

                signet.lists.forEach(el => {
                    prio = 'Start YES 1st'.includes(el.priority) ? `**${el.priority}**` : el.priority
                    table.push("**" + el.name + "**: " + el.desc + " | " + prio)
                })

                builds.push(table.join("\n"))
            }

            return builds.join("\n\n")
        }

        let getFCName = (flamechaser) => {
            let fcNameParts = flamechaser.split(" ")
            return `${fcNameParts[0]} - Signet of ${FC[fcNameParts[0].toLowerCase()]} ${fcNameParts[1] === "1" ? "(1st Core)" : `${fcNameParts[1] === "2" ? "(2nd Core)" : ""}`}`
        }

        const FC = {
            "elysia": "■■",
            "kevin": "Deliverance",
            "eden": "Gold",
            "kalpas": "Decimation",
            "su": "Bodhi",
            "sakura": "Setsuna",
            "mobius": "Infinity",
            "hua": "Vicissitude",
            "aponia": "Discipline",
            "vill-v": "Helix",
            "kosma": "Daybreak",
            "griseo": "Stars",
            "pardofelis": "Reverie"
        }

        document.getElementById('actionJSON').onclick = buildFromJSON
        document.getElementById('actionObj').onclick = objectToRentry

        document.getElementById('copyBtn').onclick = (e) => {
            navigator.clipboard.writeText(document.getElementById('outputCode').firstChild.textContent).then(
                () => {
                    console.log("copied text successfully!")
                }, (err) => {
                    console.log("can't copy text: ", err)
                }
            )
        }
    </script>
</body>

</html>